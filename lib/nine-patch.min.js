export default class NinePatch{constructor(t){this.a=t}async init(){this.b=await a(this.a),this.c=this.b.canvas.width-2,this.d=this.b.canvas.height-2,this.e=b(this.b),this.f=c(this.b),this.e&&this.f&&(this.g=document.createElement('canvas'),this.h=this.g.getContext('2d'),this.i=this.e.reduce((t,a)=>t+(a<0?-a:0),0),this.j=this.f.reduce((t,a)=>t+(a<0?-a:0),0),this.k=d(this.b))}draw(t){let a=t.clientWidth,i=t.clientHeight,e=this.getBase64(a,i);e?((this.k[0]||this.k[1]||this.k[2]||this.k[3])&&(this.k[0]&&(t.style.paddingTop=`${this.k[0]}px`),this.k[1]&&(t.style.paddingRight=`${this.k[1]}px`),this.k[2]&&(t.style.paddingBottom=`${this.k[2]}px`),this.k[3]&&(t.style.paddingLeft=`${this.k[3]}px`)),t.style.boxSizing='border-box',t.style.backgroundSize=`${a}px ${i}px`,t.style.backgroundRepeat='no-repeat',t.style.backgroundImage=`url('${this.getBase64(a, i)}')`):t.style.backgroundImage=`url('${this.a}')`}getBase64(t,a){let i;if(this.e&&this.f){let e=document.createElement('canvas');e.width=t,e.height=a;let h=e.getContext('2d'),n=(t-this.i)/ (this.c - this.i), s = (a - this.j) /(this.d-this.j),g=0,d=0,r=0,c=0,l=1,o=1;for(let $=0;$<this.f.length;++$){this.g.height=Math.abs(this.f[$]);for(let p=0;p<this.e.length;++p)this.g.width=Math.abs(this.e[p]),this.h.drawImage(this.b.canvas,l,o,this.g.width,this.g.height,0,0,this.g.width,this.g.height),g=this.e[p]<0?-this.e[p]:this.e[p]*Math.max(n,0),d=this.f[$]<0?-this.f[$]:this.f[$]*Math.max(s,0),h.drawImage(this.g,0,0,this.g.width,this.g.height,r,c,g,d),r+=g,l+=this.g.width;r=0,c+=d,l=1,o+=this.g.height}i=e.toDataURL('image/png')}return i}}function a(t){return new Promise((a,i)=>{let e=new Image;e.src=t,e.crossOrigin='Anonymous',e.onload=()=>{let t=document.createElement('canvas'),i=e.width,h=e.height;t.width=i,t.height=h;let n=t.getContext('2d',{willReadFrequently:!0});n.drawImage(e,0,0,i,h),a(n)},e.onerror=i})}function b(t){let a=t.getImageData(1,0,t.canvas.width-2,1).data;return g(a)}function c(t){let a=t.getImageData(0,1,1,t.canvas.height-2).data;return g(a)}function d(t){let a=t.getImageData(t.canvas.width-1,1,1,t.canvas.height-2).data,i=g(a),e=f(i),h=t.getImageData(1,t.canvas.height-1,t.canvas.width-2,1).data,n=g(h),s=f(n);return[e[0],s[1],e[1],s[0]]}function f(t){let a=[void 0,void 0];switch(t?.length){case 1:t[0]>0&&(a[0]=0,a[1]=0);break;case 2:t[0]>0?(a[0]=0,a[1]=-t[1]):(a[0]=-t[0],a[1]=0);break;case 3:t[0]<0&&(a[0]=-t[0],a[1]=-t[2])}return a}function g(t){let a;if(t.length>=4&&t.length%4==0){let i=0;(a=[])[i]=255===t[3]?1:-1;for(let e=4;e<t.length;e+=4){if(0!==t[e]||0!==t[e+1]||0!==t[e+2]||255!==t[e+3]&&0!==t[e+3]){a=void 0;break}let h=255===t[e+3];a[i]>0!==h&&(a[++i]=0),a[i]+=h?1:-1}1===a?.length&&0>=a[0]&&(a=void 0)}return a}